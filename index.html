<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Share</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 24 24' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14 2H6C4.89543 2 4 2.89543 4 4V20C4 21.1046 4.89543 22 6 22H18C19.1046 22 20 21.1046 20 20V8L14 2Z' fill='%237C3AED'/%3E%3Cpath d='M14 2V8H20L14 2Z' fill='%23A78BFA'/%3E%3Cpath d='M8 13H16M8 17H13' stroke='white' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E">
    <style>
        :root {
            /* Material You (MD3) Color Tokens */
            --md-sys-color-primary: #6750a4;
            --md-sys-color-on-primary: #ffffff;
            --md-sys-color-primary-container: #eaddff;
            --md-sys-color-on-primary-container: #21005d;
            --md-sys-color-secondary-container: #e8def8;
            --md-sys-color-on-secondary-container: #1d192b;
            --md-sys-color-background: #fef7ff;
            --md-sys-color-surface: #fef7ff;
            --md-sys-color-surface-container-high: #ece6f0;
            --md-sys-color-on-surface: #1d1b20;
            --md-sys-color-on-surface-variant: #49454f;

            --md-sys-shape-corner-large: 16px;
            --md-sys-shape-corner-full: 9999px;
            --md-sys-typescale-body: system-ui, -apple-system, sans-serif;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --md-sys-color-primary: #d0bcff;
                --md-sys-color-on-primary: #381e72;
                --md-sys-color-primary-container: #4f378b;
                --md-sys-color-on-primary-container: #eaddff;
                --md-sys-color-secondary-container: #4a4458;
                --md-sys-color-on-secondary-container: #e8def8;
                --md-sys-color-background: #141218;
                --md-sys-color-surface: #141218;
                --md-sys-color-surface-container-high: #2b2930;
                --md-sys-color-on-surface: #e6e1e5;
                --md-sys-color-on-surface-variant: #cac4d0;
            }
        }

        * { box-sizing: border-box; }

        body {
            margin: 0;
            padding: 0;
            font-family: var(--md-sys-typescale-body);
            background-color: var(--md-sys-color-background);
            color: var(--md-sys-color-on-surface);
        }

        header {
            padding: 24px 24px 40px 24px;
            max-width: 800px;
            margin: 0 auto;
        }

        h1 {
            font-size: 2.5rem;
            font-weight: 400;
            margin: 0;
        }

        h2 {
            font-size: 1.2rem;
            font-weight: 400;
            color: var(--md-sys-color-on-surface-variant);
            margin: 8px 0 0 0;
        }

        main {
            max-width: 800px;
            margin: 0 auto;
            padding: 0 16px 40px 16px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .file-card {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background-color: var(--md-sys-color-surface-container-high);
            padding: 16px 24px;
            border-radius: var(--md-sys-shape-corner-large);
            transition: background-color 0.2s;
            text-decoration: none;
            color: inherit;
        }

        .file-card:hover {
            background-color: var(--md-sys-color-secondary-container);
            color: var(--md-sys-color-on-secondary-container);
        }

        .file-info {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .file-name {
            font-size: 1rem;
            font-weight: 500;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            margin-bottom: 4px;
        }

        .file-size {
            font-size: 0.875rem;
            opacity: 0.7;
        }

        .download-btn {
            background-color: var(--md-sys-color-primary);
            color: var(--md-sys-color-on-primary);
            padding: 10px 20px;
            border-radius: var(--md-sys-shape-corner-full);
            font-weight: 500;
            font-size: 0.9rem;
            margin-left: 16px;
            white-space: nowrap;
            flex-shrink: 0;
        }

        .loader {
            text-align: center;
            padding: 40px;
            opacity: 0.7;
        }
    </style>
</head>
<body>
    <header>
        <h1>Shared Files</h1>
        <h2 id="count">Loading...</h2>
    </header>

    <main id="file-list">
        <div class="loader">Fetching metadata...</div>
    </main>

    <script>
        function formatBytes(bytes, decimals = 2) {
            if (!+bytes) return '0 Bytes';
            const k = 1024;
            const dm = decimals < 0 ? 0 : decimals;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return `${parseFloat((bytes / Math.pow(k, i)).toFixed(dm))} ${sizes[i]}`;
        }

        async function loadFiles() {
            try {
                const response = await fetch('/metadata');
                if (!response.ok) {
                    throw new Error("Failed to load");
                }
                const files = await response.json();

                const list = document.getElementById('file-list');
                const count = document.getElementById('count');

                list.innerHTML = '';
                count.textContent = `${files.length} file${files.length !== 1 ? 's' : ''} available`;

                if (files.length === 0) {
                    list.innerHTML = '<div class="loader">No files shared.</div>';
                    return;
                }

                files.forEach(file => {
                    const card = document.createElement('a');
                    card.className = 'file-card';
                    card.href = `/download/${file.uuid}`;
                    // Force download attribute to help browser
                    card.setAttribute('download', '');

                    card.innerHTML = `
                        <div class="file-info">
                            <span class="file-name" title="${file.file_name}">${file.file_name}</span>
                            <span class="file-size">${formatBytes(file.file_size)}</span>
                        </div>
                        <div class="download-btn">Download</div>
                    `;
                    list.appendChild(card);
                });

            } catch (error) {
                document.getElementById('file-list').innerHTML = `
                    <div class="loader" style="color: var(--md-sys-color-error)">
                        Error loading files. Please refresh.
                    </div>
                `;
            }
        }

        loadFiles();
    </script>
</body>
</html>
